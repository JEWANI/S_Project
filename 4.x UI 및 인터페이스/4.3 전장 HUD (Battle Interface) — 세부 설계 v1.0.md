## 0) 목적·전제

- **목적:** 반턴제 전투를 시각화하고, 플레이어 개입(오퍼레이터 카드/명령)을 최소 UI 마찰로 처리.
    
- **전제:** 플레이어가 개입하지 않으면 유닛은 AI 계획대로 진행. 개입 시 일시 정지·슬로우·우선권(QTE형) 처리.
    

---

## 1) 전체 레이아웃(계층)

```mathematica
Canvas/CombatHUD
 ├─ Top_StatusBar
 ├─ Left_UnitsPanel
 ├─ Right_OperatorPanel
 │   ├─ ClaireHUD (우하단 고정)
 │   └─ CardDeckBar
 ├─ Center_WorldView (3D/전장맵 + Overlay)
 │   ├─ AimPingLayer
 │   ├─ PathPreviewLayer
 │   └─ DamageFloaters
 ├─ Bottom_TimelineBar
 ├─ MiniMapDock (좌하단)
 ├─ PauseMenu & Alerts
 └─ Toasts & Tooltips

```

---

## 2) 패널별 상세

### 2.1 Top_StatusBar (상단 상태바)

- **전장 타이머/턴 표시:** `TurnCounter`, `PhaseLabel(명령/해결)`, 실시간/슬로우 아이콘.
    
- **전장 조건:** 날씨/지형/통신 상태 아이콘(툴팁).
    
- **목표 진행률:** 메인 목표 % 게이지 + 서브 목표 점등.
    
- **긴급 경보:** 우측에 `AlertTicker`(적 증원, 폭발 카운트다운 등 실시간 메시지 1줄).
    

**연출:** 진입 0.25s 슬라이드 다운, 경보 발생 시 0.3s 흔들림(shake) + 1.0s 엠비언트 글로우.

---

### 2.2 Left_UnitsPanel (좌측 유닛 패널)

- **UnitEntry(리스트)**: 초상/HP바/AP/상태이펙트/행동대기표시.
    
- **정렬 토글:** [체력순][클래스][거리][명령상태].
    
- **필터:** [출전중][부상][명령대기][자동].
    
- **컨텍스트 메뉴:** 우클릭 → [이동 핑][엄폐 우선][교전 회피][정찰 우선].
    

**상호작용 규칙**

- 클릭: 해당 유닛 추적 카메라/전장 뷰 포커스.
    
- 드래그: 같은 분대 묶음 선택(스쿼드 핫그룹 생성, Ctrl+숫자).
    

---

### 2.3 Right_OperatorPanel (오퍼레이터 패널)

- **CardDeckBar**(하단 가로 스택): 8칸 기본, 사용 가능 카드 강조, 쿨다운·코스트 표시.
    
- **ClaireHUD**(우하단 고정): 반신 프레임 + 대사 라인 + 이펙트 링.
    
    - 카드 계열별 색상광: 전술=적/지원=청/정보=녹/방어=황/심리=보라.
        
    - 대사 길이 36자 기준 줄바꿈, Auto 음성 재생 옵션.
        

**카드 사용 플로우**

1. 카드 선택(키보드 1~8 또는 클릭) → 커서가 카드 모드.
    
2. 월드 클릭(대상/지점) → **예상 효과 미리보기**(PathPreviewLayer/범위 원).
    
3. **확정(좌클)** → **개입 시퀀스**: Claire 등장(0.25s)→대사(0.8~1.2s)→효과 적용.
    
4. 로그 기록 & 쿨다운 시작. 실패 시 원인 토스트(시야/사거리/자원 부족).
    

**실패 방지 UX**

- 사거리 밖이면 커서가 붉은 X로 변함, 툴팁에 요구치 표기.
    
- 겹치는 AoE는 겹침 경고(피해/효율 감소 안내).
    

---

### 2.4 Center_WorldView (전장 시점)

- **카메라 컨트롤:** WASD 팬, 휠 줌, Q/E 틸트, 중클릭 드래그 회전.
    
- **오버레이 레이어:**
    
    - AimPingLayer: 명령/적 발견/구조 요청 핑.
        
    - PathPreviewLayer: 이동경로, 사거리, 엄폐 영향 하이라이트.
        
    - DamageFloaters: 피해 수치, 상태이상 아이콘.
        

**가시성 규칙**

- 엄폐 하이라이트: 절대·부분 엄폐는 가장자리 라인 굵기로 구분.
    
- 고저차: 높이 차등 음영 + 사격각 아이콘(상승/하강 화살표).
    

---

### 2.5 Bottom_TimelineBar (하단 타임라인)

- **반턴제 타임라인:** `PhaseTrack(명령/해결)`, `UnitTicks`(행동 포인트 소비순).
    
- **이벤트 큐:** 폭발 카운트다운, 증원 도착, 스캔 갱신.
    
- **개입 창(QTE형):** 특정 이벤트에 **개입 버튼**이 짧게 등장(예: “차단 사격 개입(1.5s)”).
    

**작동 규칙**

- 명령 페이즈: 카드/명령 허용, 세계 시간 슬로우(기본 0.35x).
    
- 해결 페이즈: 카드 일부만 허용(반응형 카드), 세계 시간 1.0x.
    

---

### 2.6 MiniMapDock (좌하단 미니맵)

- 뷰포트 사각형 표시, 목표/우군/적군 아이콘.
    
- 클릭 이동, 드래그 박스 핑 생성.
    
- 레이어 토글: [목표][우군][적군][소음/발각도].
    

---

### 2.7 PauseMenu & Alerts

- **일시정지 메뉴:** 옵션/재시작/퇴각/임무 포기.
    
- **알럿 다이얼로그:** 퇴각 확인, 아군 사망, 민간인 피해 경고 등.
    

---

### 2.8 Toasts & Tooltips

- 우상단 토스트 스택: 3개까지 겹치기, 2.5s 후 사라짐.
    
- 툴팁은 마우스 정지 0.35s 후 표시, 패드 사용 시 L3로 툴팁 토글.
    

---

## 3) 데이터 바인딩(핵심 맵)

- **전장 공통:** `BattleContext`(씬 단일톤)
    
    - `missionId`, `seed`, `phase`, `timeScale`, `weather`, `terrain`, `comms`.
        
    - `objectives[]`(진행률), `events[]`(타임드), `threatLevel`.
        
- **유닛:** `UnitRuntime`(ID, HP/AP, 위치, 상태이상, 태스크큐).
    
- **카드:** `OperatorCardDef` + `CardRuntime`(쿨다운, 소모, 가용여부).
    
- **클레어 대사:** `ClaireLineRuntime`(상황별 키/우선순위/쿨타임).
    

**UI 연결 예**

- `Top_StatusBar/TurnCounter` ← `BattleContext.turnIndex`
    
- `Left_UnitsPanel/List` ← `UnitRuntime[]` 정렬·필터 바운딩
    
- `Right_OperatorPanel/CardDeckBar` ← `CardRuntime[]`
    
- `Bottom_TimelineBar/UnitTicks` ← `UnitRuntime.actionOrder`
    
- `MiniMapDock` ← `WorldState`의 단순화 피드
    

---

## 4) 상태 머신(페이즈)

- **Idle → CommandPhase → ResolvePhase → AftermathCheck → CommandPhase …**
    
    - `CommandPhase`: 카드/명령 입력 허용, 미리보기 활성.
        
    - `ResolvePhase`: 입력 제한, AI 및 피직스 처리, 데미지/상태 계산.
        
    - `AftermathCheck`: 목표 달성/실패/진행 평가, 이벤트 스폰, 루프 반복.
        
- **긴급 인터럽트:** 치명 이벤트(핵심 유닛 사망/목표 붕괴) → 슬로우 + 컨펌 알럿.
    

---

## 5) 개입(오퍼레이터 카드) 시퀀싱 규칙

- **연출 우선순위:** 효과 > 대사 > 잔상.
    
    - Apply(프리이펙트 0.15s) → ClaireSpeak(0.6~1.0s, 병렬 가능) → Sustain FX → Fade(0.4s)
        
- **스택 제한:** 동계열 카드 연속 사용 시 15% 효율 감쇠(툴팁 안내).
    
- **로그:** `OperatorLog`에 카드명/대상/결과/시간 기록 → 4.4 결과 화면으로 전달.
    

---

## 6) 접근성·가독성

- 텍스트 최소 16pt, HUD 대비 4.5:1 이상.
    
- 색상만으로 상태 구분 금지(아이콘/패턴 동시 제공).
    
- 카메라 흔들림 강도 옵션화(0~100%), 기본 30%.
    
- 색약 보정 모드(전술=적색 대신 적보라, 정보=녹 대신 청록 대체 팔레트).
    

---

## 7) 성능 가이드(PC 기준, 중간 사양)

- **HUD 드로우콜 목표:** ≤ 120
    
- **업데이트 틱:** World 60Hz / HUD 30Hz / Floaters 30Hz
    
- **GC 방지:** DamageFloaters 오브젝트 풀링(200개), 토스트/툴팁 풀링.
    
- **선형 색공간 + HDR OFF(기본)**, 포스트 최소화(블룸 약), AO 비활성 기본.
    

---

## 8) 사운드·피드백

- **카드 사용:** 계열별 징글(최대 0.9s), 다이 재생 금지.
    
- **명령 성공/실패:** 상승/하강 2톤 UI SFX, 실패는 -6dB로 짧게.
    
- **피해/치유:** 플로터 팝 SFX, 과도 중첩 방지 위해 0.05s 레이트리밋.
    

---

## 9) 오류·엣지 케이스

- 목표가 이동하는 임무: Objective 마커는 스무딩 추적(0.2s 보간).
    
- 경로 미탐색: PathPreview는 붉은 파선 + “장애물/경사 과다”.
    
- 통신 두절 상태: 카드/명령 사거리 절반, 대사 지연(연출) + 재시도 힌트.
    

---

## 10) QA 체크리스트(스모크)

- 카드 쿨다운 UI ↔ 실제 재사용 가능 시간 일치.
    
- 미니맵 뷰포트/메인 카메라 프러스텀 싱크 오차 ≤ 2px.
    
- 타임라인 순서가 HP/AP/상태 변화 후에도 역전 없이 갱신.
    
- 슬로우/정지 전환 시 SFX 피치 보정 정상(피치=타임스케일).
    

---

## 11) 로그·텔레메트리(선택)

- 이벤트: `card_used`, `objective_progress`, `unit_down`, `intercept_qte`.
    
- 지표: 평균 개입 횟수/턴, 카드 미스율, HUD 상호작용 비율.
    

---

## 12) 연동 문서

- **2.7.2 오퍼레이터 명령 개입 시뮬레이션 플로우**: 페이즈/타임스케일/해석 규칙 공유
    
- **2.7.3 오퍼레이터 카드 개입 시스템**: 카드 계열/대사/이펙트 컬러 매핑
    
- **4.2 브리핑 화면**: 목표/경로/위험도 초기값을 HUD로 인계
    
- **4.4 임무 결과**: 로그·통계·명성/치안 실측치 반환