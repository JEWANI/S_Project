**버전:** v0.8 Draft  
**연동:** 2.10 전투 AI 행동 알고리즘 / 3.3 전장 HUD / 2.8 시뮬레이션 메타 매니저

---

## 1) 목적

- AI 유닛의 의사결정 과정을 **가시화·분석**하기 위한 개발·튜닝용 패널.
    
- 각 유닛이 현재 상황에서 어떤 행동 후보를 얼마나 높은 효용(U)을 두고 평가하는지, 그리고 그 결정이 어떤 입력 요인(위협, 커버, 시너지 등)에 의해 도출됐는지 실시간 표시.
    
- 디자이너와 밸런스 담당이 ‘왜 그 유닛이 그런 판단을 했는가’를 **즉시 시각적으로 확인**할 수 있도록 함.
    

---

## 2) 패널 구조 (전장 HUD의 오버레이 탭)

```
🧠 [AI Debug Panel]
 ├─ Unit Selector (Dropdown)
 │   ├─ 현재 전투 중 아군/적 목록
 │   └─ 클릭 시 해당 유닛 하이라이트
 ├─ Utility Breakdown (Bar Graph)
 │   ├─ 상위 5개 행동 후보 및 U(A) 값
 │   └─ 각 항목 색상:
 │        🔴 공격 / 🔵 이동 / 🟢 지원 / 🟣 특수 / 🟡 방어
 ├─ Weight Factors (Radar Graph)
 │   ├─ wG~wR 7축 그래프
 │   └─ 현재 행동 기준 가중치 표시
 ├─ Threat / Opportunity Map (Mini 2D Heatmap)
 │   ├─ 빨강 = 위험 / 파랑 = 안전 / 녹색 = 기회
 │   └─ 실시간 업데이트 (2.8의 히트맵 데이터 사용)
 ├─ Decision Trace (Timeline)
 │   ├─ Perceive → Evaluate → Act → PostCheck 순서 표시
 │   └─ 각 구간 클릭 시 세부 로그 팝업
 └─ Controls
     ├─ ☐ 실시간 갱신 (ON/OFF)
     ├─ ☐ 상위 N=3만 표시
     ├─ ☐ 로그 내보내기 (CSV / JSON)
     ├─ [⟳] 리셋 / [⏸] 정지 / [▶] 재생

```

## 3) 표시 항목 세부 정의

|항목|설명|데이터 출처|
|---|---|---|
|**U(A)**|행동 효용값 (0~1 정규화)|2.10의 유틸리티 계산기|
|**GoalScore**|목표 달성도 기여|Mission Context|
|**ThreatDelta**|위험 변화량|Danger Map|
|**CoverQuality**|엄폐 평가 (0~1)|Terrain Manager|
|**HitProb / DmgExp**|명중률·기대 피해|Combat Resolver|
|**APEfficiency**|행동 포인트 효율|TurnManager|
|**Synergy / RiskControl**|연계·위험 보정|AI Context, 2.8|
|**ActionChain**|현재 선택된 행동 시퀀스|AI Planner|

---

## 4) 시각 연출

- **유닛 선택 시:**  
    유닛 머리 위에 투명한 반투명 원형 **HUD Halo** 생성 (색상=유닛 진영색).  
    Hover 시 “현재 판단: [행동명] / 효용 0.73 / 상태: 위협중간·엄폐良” 툴팁 표시.
    
- **Bar Graph:**  
    행동별 색상 막대 + 실시간 애니메이션.  
    가장 높은 U(A)는 Pulse 효과로 강조.
    
- **Radar Graph:**  
    각 w계수 축에 따라 변형된 다각형 표시.  
    광폭화 시 RiskControl 축 붉게 점멸.
    
- **Heatmap:**  
    전장 맵 미니뷰에서 ‘적 시야’는 붉은 영역, ‘아군 유리 지형’은 파란색.  
    실시간 업데이트 주기 0.5초.
    
- **Decision Trace:**  
    각 행동 단계에 짧은 텍스트 로그 표시:  
    예) `[Perceive] 적3명 감지 (DPS=41)` → `[Evaluate] 방어태세 효용↑` → `[Act] 엄폐 이동`.
    

---

## 5) 개발자용 기능

- **U-Value Override**: 각 w계수 수동 슬라이더 (0~1).  
    즉시 반영해 행동 선택이 어떻게 바뀌는지 확인 가능.
    
- **Replay Integration (3.4 예정)**: 전투 리플레이 중 AI 판단 재생 가능.
    
- **Export Logs**: 선택 유닛의 Decision Trace를 JSON으로 내보내 DataSheet 튜너에서 통계 분석.
    
- **Profiling Mode**: Frame별 AI 연산 비용 표시 (CPU·GC·RecalcCount).
    

---

## 6) 시스템 연동

- **2.10 전투 AI 행동 알고리즘** → `AIUtilityDebugger.cs` (핵심 데이터 공급자)
    
- **2.8 메타 매니저** → 전역 긴장도/난이도/위협 맵 데이터 공급
    
- **3.3 HUD** → UI 탭·패널 위치 및 유닛 선택 연동
    
- **2.9.1 세션 복구** → 디버그 상태(ON/OFF, 유닛선택) 세션 복원
    

---

## 7) UI 구성 스펙

- 엔진: Unity UGUI (Canvas Overlay)
    
- Prefab: `Assets/UI/DebugPanels/AIDebugPanel.prefab`
    
- Script: `Assets/Scripts/UI/Debug/AIDebugPanelController.cs`
    
- 그래프 구성: Unity LineRenderer + Image Fill 방식 (경량)
    
- Bar/Radar/Heatmap 3중 탭 구조 (좌상단 탭버튼)
    

---

## 8) 접근 규칙

- 개발 모드 또는 `DebugMode=true`일 때만 표시.
    
- 런타임 중 F9 단축키로 열고 닫을 수 있음.
    
- 일반 플레이어 빌드에서는 완전히 비활성화.
    
- 단, 튜토리얼 모드에서는 "AI 판단 보기" 교육 기능으로 축약 버전 노출 가능.
    

---

## 9) 향후 확장

- (v1.0 예정) **AI Decision Replay Viewer (4.6-A)**
    
    - 프레임별 행동 선택을 슬라이드로 재생.
        
- (v1.1 예정) **클레어 분석 모드 통합**
    
    - 클레어가 음성으로 “이 유닛은 위험을 과소평가했어요.” 같은 코멘트 생성.