## 1) 목적 / 범위

- 반턴제 전투에서 **유닛이 자율적으로 최적 행동**을 선택하도록 하는 의사결정 코어.
    
- 플레이어 개입(명령·카드·우선도 변경)과 **자율행동의 균형**을 유지.
    
- 병종·특성·장비·상태 이상·광폭화(버서크)·지형(고저차)·시야/은폐/엄폐를 종합 반영.
    

## 2) 핵심 개념

- **유틸리티 AI(Utility AI)** + **경량 GOAP(Goal-Oriented Action Planning)** 하이브리드.
    
- 상위 목표(Goal) → 후보 행동(Action) → **즉시효용 U(A)** 계산 → 최상위 선택.
    
- 필요한 경우 2~3스텝의 미니 플랜(이동→사격, 해킹→문열기 등)으로 확장.
    

### 2.1 상위 목표(Goals)

1. 임무 달성: 적 전멸/구출/호위/탈출 등 시나리오 목표 가중.
    
2. 생존 유지: 사망 위험 최소화, 치명타 회피, 커버 유지.
    
3. 자원 효율: 행동 포인트(AP)/탄약/스킬 쿨다운의 가치 극대화.
    
4. 전장 이점: 고지 선점, 시야·각도 우위, 라인 유지/돌파.
    
5. 시너지: 아군 버프/연계(정찰→저격, 통신병 해킹→돌격 등).
    

### 2.2 행동 후보(Action Examples)

- 이동(고지/엄폐/목표 방면), 사격(단사/점사/조준사격), 근접, 재장전, 방어 태세,
    
- 스킬 사용(병종·특수능력 2개 제한 반영), 해킹/드론 조작(통신병),
    
- 구조/호송/상호작용(문, 단말, 화물), 연막/수류탄/지뢰 설치,
    
- **퇴각/은신/엄폐 교체** 같은 생존 행동,
    
- **카드 연계 대기/타이밍 조절**(오퍼레이터 개입 직전 유지).
    

## 3) 유틸리티 함수 정의

각 행동 A에 대해:

```markdown
U(A) = wG*GoalScore(A) 
     + wT*ThreatDelta(A) 
     + wC*CoverQuality(A) 
     + wH*HitProb(A)*DmgExp(A)
     + wP*APEfficiency(A) 
     + wS*Synergy(A) 
     + wR*RiskControl(A)

```

- **GoalScore**: 임무 목표에의 기여(구출 거리 단축, 호위 경로 유지, 탈출 경로 개방 등).
    
- **ThreatDelta**: 현재 대비 위협 변동(받을 피해↓, 노출 각도↓, 적 시야에서 이탈↑).
    
- **CoverQuality**: 엄폐 등급(없음/반엄폐/완전엄폐) + 고저차 보정(+고지).
    
- **HitProb·DmgExp**: 명중률×기대 피해(크리티컬/방어구貫通/거리보정 포함).
    
- **APEfficiency**: 1AP당 기대 효용(남은 AP/행동 연속성).
    
- **Synergy**: 아군의 직전/예정 행동과의 연계(정찰 태그→저격 가중, 드론 표적지정→포격 가중).
    
- **RiskControl**: 과도한 노출 페널티, 우발 폭발 범위, 반격각 포함.
    

> 기본 가중치 예시(난이도 Normal):  
> wG=0.30, wT=0.20, wC=0.15, wH=0.20, wP=0.05, wS=0.07, wR=0.03  
> ※ 난이도/루트/메타 매니저(2.8)에서 동적 조정.

## 4) 상태 머신(High Level)

**Idle → Perceive → Evaluate → Act → Post-Check → Idle**

- **Perceive**: 시야/청각/정찰 태그 수집, 위협 지도 업데이트.
    
- **Evaluate**: 후보 행동 생성→U(A) 계산→상위 N개 빔서치(미니플랜) 선택.
    
- **Act**: 경로 예약, 충돌/우발검사, 실행.
    
- **Post-Check**: 임무/라인/사기/광폭화 상태 갱신, 로그 기록(2.9.1).
    

## 5) 전장 요소 반영

- **고저차**: +고지 = 시야+명중+피격감소, -저지 = 반대. 경사 이동 AP 추가.
    
- **시야/은폐/엄폐**: 광선추적 가시성, 연막/암흑/수풀 태그, 각도 보정.
    
- **라인 전투**: 분대 간 좌/중/우 라인 유지 점수(Synergy에 합산).
    
- **위험/기회 맵**: 적 화력 분포 히트맵, 아군 버프-디버프 필드.
    

## 6) 병종/특성/무기 가중치

- **병종(예: 저격/돌격/정찰/지원/정보/특수/전투/중장기병/통신병)**:
    
    - 저격: wH↑, wC↑, wG(목표 제거형)↑, 근접 회피 페널티
        
    - 돌격: wG(돌파)↑, wT(위협 감소보다 제압↑), 근접/짧은거리 DmgExp↑
        
    - 정찰: Perceive 범위↑, Synergy(표식)↑, RiskControl 가중↑
        
    - 통신병: 해킹/드론 액션의 GoalScore/Synergy 보정↑(드론 시야 공유)
        
- **특수 능력(유닛당 2개, 기지에서만 변경)**: 해당 스킬이 열리는 상황에서 **행동 후보 추가** 및 관련 w* 계수 국지적 상향.
    
- **무기**: 유효 사거리·관통·반동·점사/단발 보정이 HitProb/DmgExp에 직접 반영.
    

## 7) 광폭화(버서크) 통합 로직

- **발동 조건**(기획안 26 연동): 아군 피해 ≥80% or 네임드 유닛 큰 피해 시 확률 발동.
    
- **효과**: 공격력/민첩성/AP/지능 일시 상승.
    
- **AI 변화**:
    
    - wH↑, wG(돌파/숙청형)↑, RiskControl↓(하지만 ‘무모함 안전장치’로 최악 노출 금지 한계선 유지)
        
    - **타겟 선택**: 원한 스택/보스 우선 가중치.
        

## 8) 플레이어 개입 연동 (2.7.x)

- **명령(이동/회복/방어 + 판단 방식: 공세/수세/임의)**:
    
    - 판단 프리셋이 w* 벡터를 일시 리맵:
        
        - 공세: wG(격멸/돌파)↑, wH↑, wT↓
            
        - 수세: wC↑, wT↑, RiskControl↑, wH↓
            
        - 임의(디폴트): 상황 기반 자동 균형
            
- **카드 개입(2.7.3)**: 카드 효과가 **환경 파라미터**로 주입(예: “방어형” → CoverQuality 상수 가중↑, "정보형" → 시야/표식 확장 → HitProb/GoalScore 간접↑). 개입 중에는 **재평가 주기 단축**.
    

## 9) 반턴제 루프 통합(2.7.4)

1. **오퍼레이터 단계**: 개입/카드/우선도 조정(선택적).
    
2. **AI 단계**: 모든 유닛 Perceive→Evaluate→Act를 **이니셔티브 큐** 순서로 수행.
    
3. **충돌해결**: 경로/사격 충돌, 우발 이벤트 처리.
    
4. **틱 동기화**: 2.8 메타 매니저에 스냅샷·지표 보고.
    

## 10) 통신병: 드론·해킹(요청 반영)

- **드론 스캔**: 은폐 해제, 시야 공유(정찰 시너지 최고등급).
    
- **해킹 액션**: 터렛 무력화/적 센서 교란/문 개방 → GoalScore/Synergy 대폭↑.
    
- **우선순위**: 적 기계 유닛/시설이 다수일 때 해킹 후보 생성 가중↑.
    

## 11) 계산·튜닝 파라미터(샘플)

- 명중률: `HitProb = Base(거리보정) * (커버보정) * (고저차보정) * (표식/버프)`
    
- 기대 피해: `DmgExp = (평균피해*명중) + (치명확률*치명추가)`
    
- 위험: `Risk = Σ(적각도 노출 * 적DPS * 거리계수) - 엄폐보정 - 연막보정`
    
- 위협변화: `ThreatDelta = Risk_before - Risk_after`
    
- 커버 등급: 없음=0, 반엄폐=0.5, 완전=1.0 (+고지 +0.2)
    

난이도에 따른 기본 w* 스케일:

- Easy: 생존/커버 우선(wC,wT,wR↑), 적 DPS 보정↓
    
- Hard: 목표/화력 우선(wG,wH↑), RiskControl↓, 적 AI 재평가 주기 단축
    

## 12) 데이터/시스템 연계

- **2.8 메타 매니저**: 은하 긴장도·난이도에 따라 w* 실시간 재가중, 우발 이벤트 주입.
    
- **2.9/2.9.1**: 행동 큐/결정 로그 기록, 오토세이브 스냅샷(행동 선택 전후).
    
- **3.3 HUD**: 선택된 행동/유틸리티 상위 3개를 미니 그래프(툴팁)로 노출.
    
- **4.x UI**: 행동 이유 설명(“왜 이 행동?”) 간단 텍스트: 상위 항목과 기여 수치.
    

## 13) 디버그/검증 툴

- **Heatmap Overlay**: 위험·기회 맵 실시간 토글.
    
- **Decision Trace**: 각 유닛의 U(A) 상위 5개와 가중 분해(퍼센트 바).
    
- **What-if**: 가중치 슬라이더 조정 후 리플레이.
    

## 14) 밸런스 체크리스트

- 병종별 대표 상황 6종(개활지, 실내, 야간, 고지/협곡, 도시 엄폐, 혼전)에서 승률/피해량/행동 다양성 표준 편차.
    
- 카드 개입 전후 승률 차이 목표: ±8% 내.
    
- 광폭화 발동률 목표: 보정 전 8~12% / 난전 구간 15~20%.
    

---

### 부록 A) 미니 플랜 샘플(2-스텝)

- **저격수(표식 존재)**: 이동(고지 반엄폐) → 조준사격(치명 +20%).
    
- **통신병**: 드론 표식 → 포격 유도(지원요청).
    

### 부록 B) 우선순위 테이블(발췌)

- **구출 임무**: GoalScore(구출거리 단축) > ThreatDelta > CoverQuality
    
- **호위 임무**: Line 유지 > ThreatDelta > Synergy(보호 버프)