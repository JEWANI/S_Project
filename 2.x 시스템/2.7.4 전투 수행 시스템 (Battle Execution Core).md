

**버전:** Draft v1.0  
**연동:** 2.7.2 오퍼레이터 명령 개입 플로우 · 2.7.3 오퍼레이터 카드 개입 · 2.8 시뮬레이션 메타 매니저 · 3.3 전장 HUD · 4.3 전장 HUD UI

## 1) 개요

- **전투 규칙:** **반턴제(Half-Turn)**. 라운드마다 **오퍼레이터 반(명령 입력/개입)** → **유닛 반(AI 실행)**으로 진행.
    
- **기본 원칙:** 플레이어가 개입하지 않으면 유닛은 소속 AI 교전 규칙에 따라 **임무 목표 달성**을 향해 자율 수행.
    
- **임무 유형:** 적 전멸 / 아군 보호 / 인질 구출 / 물자 탈출 / 지점 점령 / 시간 지연 등.
    

## 2) 시간·틱 모델

- **라운드 R = 두 개의 하프턴(H1, H2):**
    
    - **H1(Operator Phase):** 명령·카드 사용·우선순위 재배치·대형 변경.
        
    - **H2(Unit Phase):** AI가 행동 큐를 해석해 일괄 실행.
        
- **서브틱:** 행동 해상도는 0.1s 서브틱으로 물리/피격 판정 동기화.
    
- **인터럽트 창:** H2 중에도 다음 이벤트에 즉시 개입 가능(소모 자원: **개입 포인트 IP**)
    
    - 피격 치명상, 목표 변경 트리거, 우호 사망, 보급선 위협, ‘광폭화’ 발동.
        

## 3) 상태 머신(상위)

- **Idle → Engage → Resolve → AfterAction → (Win/Lose/Extract)**
    
    - **Engage:** 경계/발견/기회사격/엄폐이동/특수능력 처리
        
    - **Resolve:** 데미지·상태이상·사기·피로 누적
        
    - **AfterAction:** 재장전·치료·수습·루트 업데이트
        

## 4) 명령 파이프라인 (2.7.2 준수)

1. **입력/수집:** 이동·회복·방어(기본 3명령) + 판단 방식(공세/수세/임의=리더 AI)
    
2. **검증/정규화:** 행동 포인트(AP), 사거리, 탄약, 라인오브사이트(LOS), 고저차 체크
    
3. **우선순위 큐 빌드:** 목표 우선도(Target Priority), 생존 가중치(Survivability), 임무 점수(Objective Score)
    
4. **실행 큐 배치:** 충돌 시 **대형 규칙**과 **길찾기 잠금**으로 경쟁 해결
    
5. **실행:** 서브틱 순서대로 처리, 인터럽트/리액션 훅 개방
    

## 5) 유닛 AI 코어 로직

- **행동 트리(요약):**  
    감지(ThreatScan) → 목표선정(TargetSelect) → 경로탐색(Pathfind) → 행동(Act) → 후처리(Post)
    
- **목표 선정 가중치:**  
    `ThreatScore = DmgPotential × (1-Cover) × Proximity × RoleAffinity × FlankBonus`
    
- **역할 친화도(RoleAffinity):** 병종별 표준(정찰/지원/정보/저격/돌격/전투/중장기/통신/특수).  
    예: 저격병은 고저차/원거리/노출 대상에 높은 가중, 돌격병은 근접·측면 가중.
    
- **판단 방식:**
    
    - **공세적:** 위협보다 목표 점수 우선(호전성↑)
        
    - **수세적:** 생존·엄폐 우선(후퇴/회복 빈도↑)
        
    - **임의:** 리더 AI 판단에 따름(전장 맥락 기반 다이내믹 스위칭)
        

## 6) 고저차·시야·엄폐

- **고저차 보정:**
    
    - 상향 사격: 명중률 -Δ, 관통 -δ
        
    - 하향 사격: 명중률 +Δ, 치명타 +ε  
        (Δ, δ, ε는 맵의 평균 고저 표준편차에 따라 자동 튜닝)
        
- **LOS:** 그리드 레이캐스트 + 소프트 가림(반투명 오브젝트)
    
- **엄폐:** 경량/중량 엄폐로 분리. 명중률/관통/피격각 보정.
    

## 7) 이동·행동 포인트(AP)

- **AP 기본:** 100AP/반턴 기준(병종·장비로 가감)
    
- **행동 비용 예:**
    
    - 한 칸 이동 10~14AP(지형 가중), 점프/사다리/로프 20~40AP
        
    - 사격 40~70AP(무기유형/조준), 재장전 25~45AP, 회복 40~60AP, 방어태세 30AP
        
- **연계 보너스:** 이동→사격 시 ‘급사격’ 페널티(명중↓), 사격→이동은 사기 보정↓.
    

## 8) 전투 수치·상태이상

- **기본:** 출혈, 억제, 기절, 화상, 감전, 슬로우, 해킹(통신병)
    
- **사기(모럴):** 우호 사망/리더 부상/보급선 차단 시 하락, 승세/지휘 버프/엄폐 성공 시 상승
    
- **피로:** 장기전 패널티로 명중·이동 감소, 회복 행동 시 완화
    

## 9) 특수 규칙 — **광폭화(Berserk)**

- **발동 조건:** 아군 손실률 ≥80% 또는 네임드 유닛 피해 누적치 임계 도달
    
- **효과:** 공격력/민첩/행동 포인트/지능(전술 판단 속도) 단계적 상승
    
- **UI:** 유닛 프레임 붉은 파동, 효과 수치 툴팁 표시(2.8 메타에서 로그 기록)
    

## 10) 무기·장비·해킹 연동

- **무기 분류:** 권총/기관총/기관단총/소총/저격소총/기타
    
- **장비:** 방어막·의무키트·드론(통신병)·해킹 모듈
    
- **해킹(통신병):**  
    적 드론 무력화, 센서 교란, 문/터렛 제어. 성공률=지능·거리·커버·적 보안등급 함수.
    

## 11) 카드/개입 시스템 훅 (2.7.3)

- **타이밍:** H1에 기본 사용, H2에 **IP** 소비로 인터럽트 사용 가능
    
- **효과군:** 전술/지원/정보/방어/심리의 5계열, 컬러 이펙트(적·청·녹·황·보라)
    
- **연출:** 우하단 클레어/아인 등장 → 대사 → 이펙트 → 잔향(에코)
    

## 12) 경로탐색·충돌해결

- **Pathfinding:** 계층 그래프(A* + NavGrid 하이브리드), 이동 락/우선권 규칙
    
- **충돌:** 좁은 통로 병목 시 대기큐/우회/돌파(돌격 특기) 선택
    

## 13) 승패·탈출·랭크

- **승리:** 목표 달성 / 적 전력 붕괴 / 시간 방어 성공
    
- **패배:** 핵심 유닛 사망 / 시간 초과 / 목표물 파괴
    
- **랭크:** S~C, 기준=소모 턴·피해량·명중/지원 효율·목표 초과 달성
    

## 14) 데이터·텔레메트리

- **전투 로그:** `CombatLog.json` (행동, 판정, 피해, 상태 변동)
    
- **리뷰 리플레이:** 핵심 이벤트 마커 기반 스냅샷 재생
    
- **튜너 노브(밸런스):** 명중·치명·커버 보정, 고저차 보정, AP 비용, 사기 민감도
    

## 15) UI/HUD 연결(4.3)

- 타임라인 바(하프턴 표시), 개입 포인트/IP 카운터, 광폭화 인디케이터, 엄폐/시야 라인 토글, 로그 패널
    
- 클레어/아인 라인: 전술 보고 톤 규칙(2-5 섹션 준수)
    

## 16) 성능·안정성

- **예산:** 동시 유닛 48 기준 60FPS. 서브틱 물리 분리(전투 로직 10Hz/렌더 60Hz)
    
- **오토세이브:** 턴 종료에서 2.9.1 호출, 델타 저장/CRC 무결성.