
**버전:** v1.1 (통합본)  
**상태:** ✔ 완료  
**최종 수정:** 2025-10-25

**연동 시스템:**

- 2.7.1 오퍼레이터 명령 처리 시스템
- 2.7.2 명령 개입 시뮬레이션 플로우
- 2.7.3 오퍼레이터 카드 개입 시스템
- 2.8 시뮬레이션 메타 매니저
- 2.9 시스템 통합 플로우
- 3.3 전장 HUD
- 4.3 전장 HUD UI

---

## 1. 개요

### 1.1 시스템 목적

전투 수행 시스템은 **플레이어 명령(오퍼레이터 입력) 이후** 각 유닛이 **자율적으로 전투를 수행**하는 **반턴제(Half-Turn) 시뮬레이션 루프**의 핵심입니다.

본 시스템은 다음 요소를 통합합니다:

- 전투 AI 및 전술 로직
- 피해 및 행동 연산
- 시각적 피드백 및 연출
- 클레어/아인 개입 시스템
- 루시움 간섭 효과

### 1.2 기본 원칙

**자율 수행:**

- 플레이어가 개입하지 않으면 유닛은 소속 AI 교전 규칙에 따라 **임무 목표 달성**을 향해 자율 수행
- AI는 병종, 특수 능력, 전장 상태, 사거리·시야 정보에 기반하여 행동 결정

**임무 유형:**

- 적 전멸 (Annihilation)
- 아군 보호 (Protection)
- 인질 구출 (Rescue)
- 물자 탈출 (Extraction)
- 지점 점령 (Capture)
- 시간 지연 (Defense)

---

## 2. 반턴제 구조

### 2.1 루프 개요

전투는 **라운드(Round)** 단위로 진행되며, 각 라운드는 **두 개의 하프턴(Half-Turn)**으로 구성됩니다:

```
라운드 R = H1 (Operator Phase) + H2 (Unit Phase)
```

### 2.2 7단계 전투 루프

**1단계 – 명령 입력 (Command Input)**

- 플레이어가 이동·회복·방어 등의 오퍼레이터 명령 발령
- 판단 모드 선택: 공세적(Aggressive) / 수세적(Defensive) / 임의(Auto)

**2단계 – AI 판단 (AI Decision)**

- 각 유닛이 병종, 특수 능력, 전장 상태 분석
- 사거리·시야 정보 기반 행동 결정
- 목표 우선순위 계산

**3단계 – 행동 수행 (Action Execution)**

- 이동 → 공격/지원 → 반응행동(회피·방어) 순서로 연산
- 행동 포인트(AP) 소비 처리

**4단계 – 피해 연산 (Damage Calculation)**

- 공격 성공률 판정
- 방어 수치, 지형 보정(고저차) 적용
- 병종 상성에 따른 피해량 계산

**5단계 – 피드백 및 갱신 (State Update)**

- 체력(HP), 사기(Morale), 행동력(AP) 갱신
- 특수 상태(버프·디버프) 처리
- 광폭화 여부 체크

**6단계 – 오퍼레이터 개입 (Operator Intervention)**

- 카드 개입(2.7.3) 처리
- 명령 보정(2.7.2) 적용
- 클레어/아인 개입 연출 표시

**7단계 – 턴 종료 (Turn End)**

- 남은 행동 포인트 확인
- 모든 유닛 행동 완료 시 턴 종료
- 다음 턴으로 전환

---

## 3. 시간 및 틱 모델

### 3.1 하프턴 구조

**H1: Operator Phase (오퍼레이터 페이즈)**

- 명령 입력 및 카드 사용
- 우선순위 재배치
- 대형(Formation) 변경
- 전술적 의사결정

**H2: Unit Phase (유닛 페이즈)**

- AI가 행동 큐 해석
- 일괄 실행 및 동기화
- 전투 결과 처리

### 3.2 서브틱 시스템

**서브틱 해상도:** 0.1초

- 물리 판정 동기화
- 피격 타이밍 정밀 처리
- 애니메이션 동기화

**틱 레이트:**

- 전투 로직: 10Hz (0.1초마다 갱신)
- 렌더링: 60Hz (60FPS 목표)

### 3.3 인터럽트 창 (Interrupt Window)

H2 중에도 다음 이벤트 발생 시 **즉시 개입 가능**:

**트리거 이벤트:**

- 피격 치명상 (Critical Hit)
- 목표 변경 요구
- 우호 유닛 사망
- 보급선 위협
- 광폭화(Berserk) 발동

**소모 자원:** 개입 포인트(IP, Intervention Points)

---

## 4. 상태 머신

### 4.1 전투 상태 흐름

```
Idle → Engage → Resolve → AfterAction → (Win/Lose/Extract)
```

### 4.2 상태별 세부 동작

**Idle (대기)**

- 경계 태세 유지
- 센서 스캔
- 대기 명령 수행

**Engage (교전)**

- 적 발견 및 식별
- 기회 사격(Opportunity Fire)
- 엄폐 이동
- 특수 능력 발동

**Resolve (해결)**

- 데미지 계산 및 적용
- 상태 이상 처리
- 사기 변동
- 피로도 누적

**AfterAction (후처리)**

- 재장전
- 치료 및 회복
- 시체 수습
- 경로 업데이트

**종료 상태:**

- Win (승리)
- Lose (패배)
- Extract (철수)

---

## 5. 명령 파이프라인

### 5.1 파이프라인 단계

명령 처리는 2.7.2 시스템을 준수하며 다음 단계로 진행됩니다:

**1. 입력/수집 (Input Collection)**

- 기본 명령: 이동 / 회복 / 방어
- 판단 방식: 공세 / 수세 / 임의(리더 AI)

**2. 검증/정규화 (Validation)**

```
체크 항목:
- 행동 포인트(AP) 잔여량
- 사거리 및 유효 범위
- 탄약 및 자원
- 라인 오브 사이트(LOS)
- 고저차(Elevation)
```

**3. 우선순위 큐 빌드 (Priority Queue Build)**

```
Priority = TargetPriority × Survivability × ObjectiveScore
```

**구성 요소:**

- `TargetPriority`: 목표 위협도
- `Survivability`: 생존 가중치
- `ObjectiveScore`: 임무 기여도

**4. 실행 큐 배치 (Execution Queue)**

- 충돌 시 대형 규칙 적용
- 길찾기 잠금(Pathfinding Lock)으로 경쟁 해결
- 순서 정렬 및 최적화

**5. 실행 (Execution)**

- 서브틱 순서대로 처리
- 인터럽트/리액션 훅 개방
- 실시간 상태 갱신

---

## 6. 유닛 AI 시스템

### 6.1 AI 행동 트리

```
ThreatScan → TargetSelect → Pathfind → Act → Post
```

**단계별 설명:**

1. **ThreatScan (위협 감지)**: 주변 적 탐지 및 위협도 평가
2. **TargetSelect (목표 선정)**: 가중치 기반 최적 타겟 선정
3. **Pathfind (경로 탐색)**: 안전하고 효율적인 이동 경로 계산
4. **Act (행동)**: 실제 전투 행동 수행
5. **Post (후처리)**: 결과 처리 및 상태 갱신

### 6.2 목표 선정 가중치

```
ThreatScore = DmgPotential × (1 - Cover) × Proximity 
            × RoleAffinity × FlankBonus
```

**변수 설명:**

- `DmgPotential`: 대상의 위협 수준 (0~1)
- `Cover`: 대상의 엄폐 수준 (0~1, 높을수록 타격 어려움)
- `Proximity`: 거리 역수 (가까울수록 높음)
- `RoleAffinity`: 병종별 친화도
- `FlankBonus`: 측면/배후 공격 보너스

### 6.3 역할 친화도 (Role Affinity)

병종별 표준 역할:

- **정찰병 (Scout)**: 시야 확보, 정보 수집
- **저격병 (Sniper)**: 고거리/고저차/노출 대상 우선
- **돌격병 (Assault)**: 근접/측면 공격 특화
- **지원병 (Support)**: 회복/버프 우선
- **정보병 (Intel)**: 해킹/전자전
- **전투병 (Combat)**: 범용 전투
- **중장기병 (Heavy)**: 화력 지원/방어
- **통신병 (Comms)**: 드론/네트워크 관리
- **특수병 (Special)**: 임무 특화 역할

**예시:**

```
저격병 RoleAffinity:
- 고저차 있는 목표: 1.5
- 원거리 목표: 1.3
- 노출된 목표: 1.4
- 근접 목표: 0.5

돌격병 RoleAffinity:
- 근접 목표: 1.6
- 측면/배후: 1.8
- 원거리 목표: 0.6
```

### 6.4 판단 방식 (Tactical Mode)

**공세적 (Aggressive)**

- 위협보다 목표 점수 우선
- 호전성 증가 (↑)
- 위험 감수 증가

**수세적 (Defensive)**

- 생존 및 엄폐 우선
- 후퇴/회복 빈도 증가 (↑)
- 보수적 전술

**임의 (Auto)**

- 리더 AI 판단에 따름
- 전장 맥락 기반 동적 전환
- 상황 적응형

---

## 7. 전투 연산 시스템

### 7.1 명중 공식

```
HitChance = BaseAcc + SkillMod + TerrainBonus - TargetEvasion
```

**변수 설명:**

- `BaseAcc`: 기본 명중률 (무기 기반)
- `SkillMod`: 유닛 숙련도 보정
- `TerrainBonus`: 지형 보너스/패널티
- `TargetEvasion`: 목표 회피율

**범위:** 최종 HitChance는 5%~95%로 제한

### 7.2 피해 공식

```
Damage = (Atk × WeaponCoef) - (Def × ArmorCoef)
```

**변수 설명:**

- `Atk`: 공격력 (유닛 스탯 + 무기)
- `WeaponCoef`: 무기 계수 (1.0~3.0)
- `Def`: 방어력 (유닛 스탯 + 장비)
- `ArmorCoef`: 방어구 계수 (0.5~2.0)

**최소 피해:** 1 (완전 무효화 방지)

### 7.3 치명타 (Critical Hit)

```
CritChance = LUCK × WeaponCritRate
```

**효과:**

- 피해량 ×1.5 ~ ×2.0배
- 상태 이상 확률 증가
- 사기 타격 효과

**범위:** CritChance 최대 40%

### 7.4 지형 보정

**고저차 보정:**

```
높이 우위 (상대보다 높음):
- 공격 피해: +10%
- 명중률: +Δ%
- 치명타율: +ε%

높이 열세 (상대보다 낮음):
- 공격 피해: -10%
- 명중률: -Δ%
- 관통력: -δ%
```

**Δ, δ, ε 값:**

- 맵의 평균 고저 표준편차에 따라 자동 튜닝
- 표준값: Δ=5, δ=8, ε=3

### 7.5 사기 보정

```
MoraleModifier = 1.0 + (CurrentMorale - 50) / 100
```

**효과:**

- 사기가 높을수록 (>50): 명중률·피해 증가
- 사기가 낮을수록 (<50): 명중률·피해 감소
- 반란 상태 (Morale ≤ 10): 통제 불가

### 7.6 병종 상성

```
병종 상성표:
돌격병 → 지원병 (1.3배)
저격병 → 정찰병 (1.4배)
중장기병 → 돌격병 (1.2배)
정보병 → 통신병 (1.5배)
```

---

## 8. 지형 및 환경 시스템

### 8.1 고저차 시스템

**상향 사격 (Uphill):**

- 명중률: -Δ
- 관통력: -δ
- 체감 난이도 증가

**하향 사격 (Downhill):**

- 명중률: +Δ
- 치명타율: +ε
- 전술적 우위

### 8.2 시야 시스템 (Line of Sight)

**LOS 계산:**

- 그리드 레이캐스트 기반
- 소프트 가림(반투명 오브젝트) 처리
- 동적 장애물 반영

**시야 수정자:**

- 정찰병: 시야 +2
- 야간/안개: 시야 -3
- 고지대: 시야 +1

### 8.3 엄폐 시스템 (Cover)

**엄폐 등급:**

- **경량 엄폐 (Light Cover)**: 명중률 -20%, 피해 -10%
- **중량 엄폐 (Heavy Cover)**: 명중률 -40%, 피해 -25%
- **완전 은폐 (Full Cover)**: 타격 불가 (특수 무기 제외)

**각도 보정:**

- 정면: 엄폐 효과 100%
- 측면: 엄폐 효과 50%
- 배후: 엄폐 효과 0%

### 8.4 지형 타입

**평지 (Plains)**

- 이동: 기본
- 방어: 없음
- 명중: 기본

**산악 (Mountains)**

- 이동: -1
- 방어: +10%
- 시야: +1

**도시 (Urban)**

- 이동: 기본
- 시야: -1
- 명중: -5%
- 엄폐: 풍부

**실내 (Indoor)**

- 이동: -1
- 폭발 피해: +20%
- 근접 전투: +15%

**숲 (Forest)**

- 이동: -1
- 은폐: +30%
- 화염 취약

---

## 9. 행동 포인트 시스템

### 9.1 AP 기본 구조

**기본 AP:** 100 AP/하프턴

- 병종에 따라 가감
- 장비 무게에 따라 조정
- 피로도에 따라 감소

### 9.2 행동 비용표

|행동|AP 비용|비고|
|---|---|---|
|한 칸 이동|10~14|지형 가중|
|점프/등반|20~40|고도 변화|
|사격|40~70|무기 유형/조준|
|재장전|25~45|탄창 크기|
|회복|40~60|대상 상태|
|방어 태세|30|엄폐 강화|
|스킬 사용|50~80|스킬 종류|
|드론 조작|35|통신병|
|해킹|60|정보병|

### 9.3 연계 보너스/패널티

**이동 → 사격:**

- '급사격' 페널티
- 명중률 -15%
- AP 비용 -10%

**사격 → 이동:**

- 사기 보정 감소
- 회피율 -10%

**엄폐 → 사격:**

- 명중률 +5%
- 안정성 보너스

---

## 10. 상태 이상 및 사기

### 10.1 상태 이상 목록

**출혈 (Bleeding)**

- 턴당 HP -5%
- 치료 시 해제
- 누적 가능

**억제 (Suppressed)**

- 명중률 -30%
- 이동 -50%
- 사기 -20

**기절 (Stunned)**

- 1턴 행동 불가
- 회피 불가
- 방어 -50%

**화상 (Burning)**

- 턴당 HP -8%
- 추가 피해 위험
- 물로 소화 가능

**감전 (Shocked)**

- 행동 확률 50%
- 전자 장비 오작동
- 지속 시간: 1~2턴

**슬로우 (Slowed)**

- 이동 -40%
- AP 회복 -20%

**해킹 (Hacked)**

- 통신병 전용
- 센서 교란
- 드론 무력화

### 10.2 사기 시스템 (Morale)

**사기 범위:** 0~100

**사기 하락 요인:**

- 우호 유닛 사망: -15
- 리더 부상: -10
- 보급선 차단: -8
- 연속 피격: -3/회

**사기 상승 요인:**

- 적 처치: +8
- 승세: +5
- 지휘 버프: +10
- 엄폐 성공: +3

**사기 효과:**

```
100~80: 최상 (공격력 +10%)
79~50: 정상 (기본)
49~30: 불안 (명중률 -10%)
29~10: 동요 (명중률 -25%, 후퇴 확률)
9~0: 반란 (통제 불가)
```

### 10.3 피로 시스템 (Fatigue)

**피로도 누적:**

- 장기전 (10턴 이상): +5/턴
- 고강도 전투: +10/전투
- 야간 작전: +8/전투

**피로도 효과:**

```
0~30: 정상
31~60: 경미 (명중 -5%, 이동 -10%)
61~90: 중등 (명중 -15%, 이동 -25%)
91~100: 극심 (명중 -30%, 이동 -50%, 사기 -20)
```

**회복:**

- 회복 행동: -20 피로도
- 휴식 턴: -10 피로도
- 전투 종료: 완전 회복

---

## 11. 특수 규칙

### 11.1 광폭화 (Berserk)

**발동 조건:**

```
Condition A: 아군 손실률 ≥ 80%
Condition B: 네임드 유닛 피해 누적치 ≥ 임계값
Condition C: 특수 트리거 이벤트
```

**효과:**

```
단계별 상승:
1단계 (초기): 공격력 +20%, 민첩 +10%, AP +15
2단계 (중기): 공격력 +40%, 민첩 +20%, AP +30
3단계 (말기): 공격력 +60%, 민첩 +30%, AP +50
```

**추가 효과:**

- 통제력 감소 (명령 무시 확률)
- 전술 판단 속도 증가
- 치명타율 +15%
- 방어력 -10% (공격성 증가)

**UI 표시:**

- 유닛 프레임 붉은 파동 이펙트
- 효과 수치 툴팁
- 2.8 메타 매니저 로그 기록

### 11.2 루시움 간섭 (Lucium Interference)

**간섭률 (L-Interference Rate):**

- 루시움 존재 지역에서 활성화
- 농도에 따라 0%~40% 범위

**간섭 효과 (확률적 발생):**

1. **AI 행동 오류**
    
    - 목표 선정 실패
    - 경로 계산 오류
    - 명령 해석 왜곡
2. **명령 지연**
    
    - 입력 지연: 1~3서브틱
    - 실행 지연: 명령 무시 확률
3. **특수 능력 폭주**
    
    - 스킬 효과 ×1.5
    - 제어 불가 상태
    - AP 소모 ×2
4. **시간 왜곡**
    
    - 턴 스킵 (드물게 발생)
    - 턴 중첩 (행동 2회 실행)
    - 시간 역행 (상태 롤백)

**연동:**

- 2.8 시뮬레이션 메타 매니저와 연동
- 난이도 및 불안정도 계산 반영

---

## 12. 무기 및 장비

### 12.1 무기 분류

**권총 (Pistol)**

- 사거리: 짧음 (3칸)
- AP 비용: 40
- 연사 가능

**기관총 (MG)**

- 사거리: 중간 (5칸)
- AP 비용: 60
- 억제 효과

**기관단총 (SMG)**

- 사거리: 짧음 (4칸)
- AP 비용: 45
- 근접 특화

**소총 (Rifle)**

- 사거리: 중간 (6칸)
- AP 비용: 50
- 범용성

**저격소총 (Sniper Rifle)**

- 사거리: 긴 (10칸)
- AP 비용: 70
- 치명타 특화

**기타 (Others)**

- 로켓 런처
- 화염방사기
- 레이저 무기

### 12.2 장비 시스템

**방어막 (Shield)**

- 피해 흡수: 50HP
- 재충전: 3턴
- 에너지 소모

**의무 키트 (Med Kit)**

- HP 회복: +40
- 상태 이상 해제
- 1회용

**드론 (Drone)**

- 통신병 전용
- 정찰/지원 기능
- AP 조작: 35

**해킹 모듈 (Hack Module)**

- 정보병 전용
- 적 시스템 교란
- 성공률 변동

### 12.3 해킹 시스템 (통신병)

**해킹 대상:**

- 적 드론 무력화
- 센서 교란
- 문/터렛 제어
- 통신 차단

**성공률 공식:**

```
HackSuccess = Base + Intelligence + DistanceBonus 
            - TargetSecurity - CoverPenalty
```

**변수:**

- `Base`: 기본 성공률 (50%)
- `Intelligence`: 유닛 지능 스탯
- `DistanceBonus`: 가까울수록 증가
- `TargetSecurity`: 대상 보안 등급
- `CoverPenalty`: 엄폐 중 해킹 난이도

---

## 13. 카드 개입 시스템

### 13.1 개입 타이밍

**H1 (Operator Phase):**

- 기본 사용
- IP 소모 없음
- 전술 계획 단계

**H2 (Unit Phase):**

- 인터럽트 사용
- IP 소비 필요
- 긴급 대응

### 13.2 카드 효과군 (2.7.3 연동)

**전술 계열 (Tactical - 적색)**

- 공격력 증가
- 명중률 향상
- 치명타율 증가

**지원 계열 (Support - 청색)**

- 회복
- 버프 제공
- 상태 이상 해제

**정보 계열 (Intelligence - 녹색)**

- 시야 확장
- 적 정보 노출
- 해킹 지원

**방어 계열 (Defense - 황색)**

- 방어력 증가
- 엄폐 강화
- 피해 감소

**심리 계열 (Psychological - 보라)**

- 사기 상승/하락
- 공포 유발
- 혼란 부여

### 13.3 카드 연출

**단계:**

1. 우하단에 클레어/아인 캐릭터 등장
2. 음성 대사 출력 (톤 규칙 준수)
3. 컬러 이펙트 전개 (계열별 색상)
4. 효과 적용 애니메이션
5. 잔향(에코) 효과 페이드아웃

**IP 소모:**

- 기본 카드: 1 IP
- 고급 카드: 2 IP
- 궁극 카드: 3 IP

---

## 14. 경로탐색 및 충돌

### 14.1 경로탐색 알고리즘

**하이브리드 시스템:**

```
Pathfinding = Hierarchical A* + NavGrid
```

**계층 구조:**

- 전략 레벨: 지역 간 이동
- 전술 레벨: 지역 내 이동
- 미시 레벨: 장애물 회피

### 14.2 경로 계산 요소

**비용 계산:**

```
PathCost = Distance + TerrainCost + ThreatCost + APCost
```

**변수:**

- `Distance`: 물리적 거리
- `TerrainCost`: 지형 난이도
- `ThreatCost`: 적 시야 내 위험도
- `APCost`: 행동 포인트 소비

### 14.3 충돌 해결

**좁은 통로 병목 시:**

**옵션 1: 대기 큐**

- 순서대로 통과
- 우선순위 기반 정렬

**옵션 2: 우회**

- 대체 경로 탐색
- 비용 재계산

**옵션 3: 돌파**

- 돌격병 특기
- 강제 이동
- AP 추가 소모

### 14.4 이동 잠금 (Movement Lock)

**잠금 시스템:**

- 그리드 타일 예약
- 충돌 방지
- 동시 이동 조정

**우선권 규칙:**

1. 명령 우선순위
2. 유닛 랭크
3. 행동 순서

---

## 15. 승패 판정

### 15.1 승리 조건

**적 전멸 (Annihilation)**

- 모든 적 유닛 제거
- 랭크: S~A

**목표 달성 (Objective Complete)**

- 임무 목표 완수
- 랭크: A~B

**적 전력 붕괴 (Enemy Collapse)**

- 적 사기 0 또는 후퇴
- 랭크: B~C

**시간 방어 성공 (Time Defense)**

- 제한 시간 생존
- 랭크: A~C

### 15.2 패배 조건

**핵심 유닛 사망 (Key Unit KIA)**

- 필수 보호 대상 사망
- 즉시 패배

**시간 초과 (Time Out)**

- 제한 시간 내 미달성
- 부분 보상

**목표물 파괴 (Objective Lost)**

- 보호 대상 파괴/탈취
- 즉시 패배

**전력 붕괴 (Force Collapse)**

- 아군 사기 0
- 자동 후퇴

### 15.3 랭크 시스템

**랭크 평가 기준:**

```
Score = ObjectiveBonus × TurnBonus × CasualtyPenalty 
      × AccuracyBonus × SupportBonus
```

**구성 요소:**

- `ObjectiveBonus`: 목표 달성도 (1.0~2.0)
- `TurnBonus`: 소모 턴수 (빠를수록 높음)
- `CasualtyPenalty`: 아군 손실 (적을수록 높음)
- `AccuracyBonus`: 명중률 효율
- `SupportBonus`: 지원 행동 효율

**랭크 구간:**

- S: Score ≥ 2000
- A: Score ≥ 1500
- B: Score ≥ 1000
- C: Score ≥ 500
- D: Score < 500

### 15.4 보상

**경험치:**

```
EXP = BaseEXP × RankMultiplier × ParticipationBonus
```

**자원:**

- S랭크: 자원 ×1.5
- A랭크: 자원 ×1.3
- B랭크: 자원 ×1.0
- C랭크: 자원 ×0.7

**특수 보상:**

- 훈장 (S랭크)
- 장비 드롭
- 명성 상승

---

## 16. 시각 연출 및 UI

### 16.1 실시간 HUD

**전투 로그:**

```
예시:
"돌격병 A → 적 저격병 B 공격"
"명중: 82% → Hit!"
"피해: 24 (치명타!)"
"저격병 B 사망"
```

**정보 표시:**

- 행동 중 유닛 강조
- 경로 라인 표시
- 피해 숫자 팝업
- 상태 아이콘 갱신

### 16.2 피격 이펙트

**피격 시:**

- UI 화면 흔들림
- 붉은 피격선 이펙트
- 체력바 애니메이션 갱신
- 사운드 효과

**치명타 시:**

- 강렬한 플래시
- 슬로우 모션 (0.5초)
- 특수 사운드
- 화면 진동 강화

### 16.3 클레어/아인 개입 연출

**위치:** 우측 하단

**요소:**

1. 캐릭터 초상화 슬라이드인
2. 음성 대사 출력
3. 자막 표시 (선택적)
4. 배경 효과 (계열별 컬러)
5. 페이드아웃

**대사 톤 규칙:**

- 전술 보고: 간결하고 명확
- 긴급 상황: 강조와 긴장감
- 성공: 긍정적이고 격려
- 실패: 냉정하고 분석적

### 16.4 턴 종료 요약

**전황 요약 패널:**

```
┌─────────────────────────────┐
│ 턴 5 종료                   │
├─────────────────────────────┤
│ 아군 생존율: 85%            │
│ 적 생존율: 42%              │
│ 지역 점령률: 67%            │
│ 남은 턴수: 8턴              │
├─────────────────────────────┤
│ 주요 이벤트:                │
│ • 적 저격병 2명 제거        │
│ • C지점 점령 완료           │
│ • 돌격병 A 중상             │
└─────────────────────────────┘
```

### 16.5 HUD 요소 (3.3/4.3 연동)

**타임라인 바:**

- 하프턴 H1/H2 표시
- 다음 행동 예고
- 이벤트 마커

**개입 포인트 카운터:**

- IP 잔여량 표시
- 충전 속도 표시
- 사용 가능 카드 강조

**광폭화 인디케이터:**

- 발동 임계값 표시
- 단계별 게이지
- 효과 툴팁

**엄폐/시야 토글:**

- 엄폐 지역 하이라이트
- 시야 원뿔 표시
- LOS 라인 시각화

**로그 패널:**

- 최근 10개 이벤트
- 필터링 옵션
- 상세 정보 확장

---

## 17. 데이터 및 텔레메트리

### 17.1 전투 로그

**로그 형식:** JSON

```json
{
  "battleID": "B-2401-045",
  "timestamp": "2025-10-25T14:32:00Z",
  "round": 5,
  "phase": "H2",
  "events": [
    {
      "type": "attack",
      "attacker": "Unit_A_01",
      "target": "Enemy_B_03",
      "hitChance": 0.82,
      "result": "hit",
      "damage": 24,
      "critical": true
    }
  ]
}
```

**기록 항목:**

- 행동 (이동/공격/회복)
- 판정 결과 (명중/회피/치명타)
- 피해량 및 상태 변화
- 사기/피로 변동
- 카드 사용 기록

### 17.2 리뷰 리플레이

**기능:**

- 전투 재생
- 키 이벤트 스냅샷
- 느린/빠른 재생
- 특정 턴 점프

**마커:**

- 전투 시작/종료
- 유닛 사망
- 목표 달성
- 카드 사용
- 광폭화 발동

### 17.3 성능 지표

**텔레메트리 수집:**

```
- 평균 FPS
- 프레임 드롭 빈도
- AI 연산 시간
- 경로탐색 시간
- 메모리 사용량
```

**최적화 목표:**

- 60FPS 유지
- AI 연산 < 10ms/프레임
- 메모리 < 2GB

### 17.4 밸런스 튜닝 노브

**조정 가능 변수:**

- 명중률 베이스
- 치명타율 배수
- 엄폐 보정 강도
- 고저차 보정값
- AP 비용
- 사기 민감도

**실시간 조정:**

- 개발자 콘솔
- 설정 파일 (JSON)
- 핫 리로드 지원

---

## 18. 성능 및 안정성

### 18.1 성능 예산

**목표 사양:**

- 동시 유닛: 48기
- 목표 프레임: 60 FPS
- 최대 맵 크기: 100×100 그리드

**연산 분리:**

- 전투 로직: 10Hz (0.1초마다)
- 물리 시뮬레이션: 30Hz
- 렌더링: 60Hz

**최적화 기법:**

- 멀티스레딩 (AI 연산)
- 공간 분할 (쿼드트리)
- LOD (거리별 상세도)
- 오브젝트 풀링

### 18.2 안정성

**오토세이브:**

- 턴 종료 시 자동 저장
- 2.9.1 시스템 호출
- 델타 저장 (증분 방식)
- CRC 무결성 검증

**에러 처리:**

```python
try:
    execute_battle_action(unit, target)
except PathfindingError:
    fallback_to_defensive_position()
except AIDecisionError:
    use_default_behavior()
except:
    log_error_and_skip_turn()
```

**복구 메커니즘:**

- 상태 롤백 (1턴 전)
- 세이브 포인트 복구
- 긴급 종료 방지

### 18.3 디버그 도구

**개발자 모드:**

- 프레임 타이머 표시
- AI 의사결정 시각화
- 히트박스 표시
- 경로 디버그 라인
- 상태 덤프

**테스트 명령:**

- 특정 턴 점프
- 유닛 상태 강제 변경
- 전투 속도 조절
- 카메라 자유 이동

---

## 19. 시스템 연동 구조

### 19.1 연동 다이어그램

```
[2.7.1 명령 처리]
        ↓
[2.7.2 명령 개입 플로우]
        ↓
[2.7.4 전투 수행] ←→ [2.7.3 카드 개입]
        ↓
[2.8 메타 매니저] ←→ [3.3 전장 HUD]
        ↓
[2.9 통합 플로우]
```

### 19.2 데이터 흐름

**입력:**

- 플레이어 명령 (2.7.1)
- 카드 사용 (2.7.3)
- 환경 변수 (2.8)

**처리:**

- AI 판단
- 전투 연산
- 상태 갱신

**출력:**

- 전투 결과
- 로그 데이터
- UI 업데이트
- 경제/정치 피드백 (2.8)

### 19.3 이벤트 시스템

**이벤트 발행:**

```csharp
EventBus.Publish(new UnitKilledEvent {
    KilledUnit = target,
    Killer = attacker,
    Timestamp = Time.Now
});
```

**구독자:**

- UI 시스템 (애니메이션)
- 사기 시스템 (보정)
- 통계 시스템 (기록)
- 메타 매니저 (글로벌 반영)

---

## 20. 향후 확장 계획

### 20.1 v1.2 계획

**전술 모드 추가:**

- 유닛 포메이션 시스템
- 협공 메커니즘
- 팀 연계 스킬
- 대형 변경 전술

**환경 상호작용:**

- 폭발물 사용
- 연료통 유폭
- 전력선 절단
- 구조물 파괴

### 20.2 v1.3 계획

**루시움 이상현상 연출:**

- 시간 왜곡 비주얼
- 공간 왜곡 효과
- 행동 반복 루프
- 인과율 붕괴

**전투 리플레이:**

- 전체 전투 녹화
- 멀티 카메라 앵글
- 하이라이트 자동 생성
- SNS 공유 기능

### 20.3 장기 비전

**AI 강화:**

- 딥러닝 기반 전술 AI
- 플레이어 패턴 학습
- 동적 난이도 조절

**멀티플레이어:**

- PvP 전투 모드
- 협동 작전
- 비동기 대전

---

## 부록 A: 공식 요약

### 전투 연산

```
HitChance = BaseAcc + SkillMod + TerrainBonus - TargetEvasion
Damage = (Atk × WeaponCoef) - (Def × ArmorCoef)
CritChance = LUCK × WeaponCritRate
```

### AI 판단

```
ThreatScore = DmgPotential × (1-Cover) × Proximity 
            × RoleAffinity × FlankBonus
Priority = TargetPriority × Survivability × ObjectiveScore
```

### 상태 보정

```
MoraleModifier = 1.0 + (CurrentMorale - 50) / 100
PathCost = Distance + TerrainCost + ThreatCost + APCost
```

### 랭크 평가

```
Score = ObjectiveBonus × TurnBonus × CasualtyPenalty 
      × AccuracyBonus × SupportBonus
```

---

## 부록 B: 병종별 특성표

|병종|시야|이동|AP|주특기|
|---|---|---|---|---|
|정찰병|+2|+1|110|정찰/정보|
|저격병|+1|-1|90|장거리 저격|
|돌격병|0|+1|105|근접 전투|
|지원병|0|0|100|회복/버프|
|정보병|+1|0|95|해킹/전자전|
|전투병|0|0|100|범용 전투|
|중장기병|-1|-1|85|화력 지원|
|통신병|0|0|100|드론/네트워크|
|특수병|+1|+1|105|임무 특화|

---

## 부록 C: 용어 사전

- **H1/H2**: Half-Turn 1/2, 반턴제의 오퍼레이터/유닛 페이즈
- **AP**: Action Points, 행동 포인트
- **IP**: Intervention Points, 개입 포인트
- **LOS**: Line of Sight, 시야선
- **CRC**: Cyclic Redundancy Check, 순환 중복 검사
- **ROI**: Return on Investment (여기서는 승리 가치)
- **Berserk**: 광폭화, 극한 상황 발동 특수 상태
- **L-Interference**: Lucium Interference, 루시움 간섭

---

**문서 버전:** v1.1 (통합본)  
**최종 수정일:** 2025-10-25  
**작성자:** S_Project Team  
**상태:** 완료 및 구현 준비 완료

**비고:**  
본 시스템은 2.7.x 전투 모듈군의 최종 루프 구조를 규정하며, 3.3 전장 HUD와 직접 연결됩니다. 루시움 간섭 확률, 전장 시야 시스템, AI 우선순위 트리 등은 2.8 시뮬레이션 메타 매니저 v1.1에서 조정됩니다.