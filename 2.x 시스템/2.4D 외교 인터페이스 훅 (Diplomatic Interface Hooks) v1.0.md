
> 목적: 2.4B(관계·명분), 2.4C(GTI 변동), 2.9(메타 매니저)와 **4.x 외교 패널 UI** 사이의 데이터 바인딩·이벤트 흐름·상태 관리 규칙을 정의한다. 실시간 외교 조작이 경제(2.1.3), 확장(2.3), 기업 통제(2.5)에 즉시 반영되도록 한다.

---

## 1) 화면 구조 (4.x 외교 패널 레이아웃)

**패널 구성**

- **상단 요약 바**: `GTI, GPI, Legitimacy, Epoch` 게이지 + 조약 상태 배지(동맹/휴전/제재/FTA)
    
- **관계 매트릭스 뷰**: 국가×국가 `Rij` 히트맵(스파크라인: 8턴 추세)
    
- **상대국 디테일 카드**: 선택 국가의 `Rij, L, P, Trade, Sanction, Treaties` 요약
    
- **행동 콘솔(Action Console)**: 조약 체결/파기, 제재, 중재, 치안지원, 투자·협력 제안 버튼
    
- **사이드 로그**: 외교 이벤트 타임라인(2.1.4 연동)
    

반응형 규칙: 미니맵(2.1.5) 오버레이로 선택 국가/동맹권 표시, 색상은 색약 안전 팔레트 적용.

---

## 2) 데이터 바인딩 (I/O 계약)

**입력(표시용)**

- from 2.4B: `Rij(norm), L, P, Rλ`
    
- from 2.4C: `τ_n, GTI`
    
- from 2.9: `Epoch, Legitimacy(global), PhaseTriggers`
    
- from 2.1.3: `TradeVolume_ij, PriceVolatility`
    

**출력(명령/정책)**

- `TreatyAction(type, target, terms)` → 2.4 엔진
    
- `SanctionAction(level, target)` → 2.4/2.1.3 (무역·가격 가중치 갱신)
    
- `MediationAction(parties, cost)` → 2.4B/C (관계·GTI 보정)
    
- `SecurityAid(region, garrison)` → 2.3/2.1.2 (Instability/Garrison 반영)
    
- `TradeOffer(goods, tariff)` → 2.1.3 (무역 파이프 가중치 변경)
    

**형식(JSON 예시)**

```json
{
  "action": "Treaty",
  "type": "FTA",
  "target": "Federation",
  "terms": {"duration": 6, "tariff": -0.15, "security": 0.05}
}
```

---

## 3) 상호작용 흐름 (UX Flow)

1. 플레이어가 행동 콘솔에서 정책 선택 → 파라미터 슬라이더/토글 설정
    
2. **효과 미리보기(Preview)** 표시:
    
    - `ΔRij, ΔL, Δτ_n, ΔGTI, ΔTradeVolume, ΔLogiCost` 예측(신뢰도 바 포함)
        
3. **확정(Commit)** → 2.4 엔진에 명령 전송, 2.9에 이벤트 노티파이
    
4. **쿨다운/비용 처리**: 외교 포인트 소모, 시간 지연(T turns)
    
5. **결과 피드백**: 성공/실패/부분성공 → 관계·명분·GTI·무역 반영, 로그에 기록
    

---

## 4) 상태 & 이벤트

**패널 상태 머신**: `Idle → Drafting → Preview → Committed → Cooldown → Idle`

**에러/차단 케이스**

- 명분 L<80: 고위험 경고, 일부 행동 잠금
    
- GTI>0.7: 휴전/중재 성공률 -30%, 미리보기에서 붉은 경고 배지
    
- 제재 중복: 같은 타깃에 중복 레벨 금지, 상향·완화만 허용
    

---

## 5) 정책 훅(2.4B/2.4C/2.9/2.1.3/2.3/2.5)

|액션|즉시 효과(Preview/Commit)|지속 효과(T턴)|연동|
|---|---|---|---|
|동맹 체결|`ΔRij +15`, `ΔL +10`|`C_treaty +0.2`, `Trade +5%`|2.4C(τ↓), 2.1.3(물류↓)|
|휴전|`ΔGTI −0.05`|교전국 `τ_n −0.1`|2.9(GTI↓)|
|제재|`Trade −x%`, `PriceFloor +φ`|`ResourceBonus ×(1−τ)`|2.1.3/2.3|
|FTA|`LogiCost ×(1−τ_trade)`|`InfraBoost +0.03`|2.3/2.1.3|
|중재|성공 시 `ΔRij +10`, 실패 시 `ΔRij −5`|`GTI −0.03`|2.4C/2.9|
|치안지원|`Garrison +0.15`, `Instability −0.15`|`τ_r −0.1`|2.1.2/2.3|
|공동투자|`InfraBoost +0.05`|`ROIexp +0.05`|2.5/2.3|

---

## 6) 접근성·텔레메트리

- 색각 안전 팔레트, 키보드 포커스 이동, 스크린 리더 라벨 제공
    
- 텔레메트리: 행동 선택률, 미리보기 신뢰도 vs. 실제 결과 오차, 국가별 액션 편향
    

---

## 7) QA 체크리스트

-  제재 레벨 2 적용 → 무역량 −20%±2%, GTI +0.05±0.02
    
-  휴전 3턴 유지 → τ_n 평균 −0.1, GTI 0.05↓
    
-  FTA 체결 즉시 LogiCost 10%↓, 2턴 뒤 무역량 +5% 반영
    
-  중재 실패 2회 연속 → Rij −10 누적 및 명분 −5 반영
    

---

## 8) 버전

- v1.0 (2025-10-24, Asia/Seoul): 레이아웃, I/O, UX 플로우, 정책 훅, 접근성, QA 정의.