#
> 목적: S프로젝트의 모든 시스템(2.1~2.8)에서 발생하는 변수·상태·이벤트를 통합하여 **은하 전체의 동적 상태(Global State)** 를 계산·관리한다. 이 매니저는 경제, 정치, 치안, 명성, 확장, 이벤트, 전장 루프를 하나의 프레임워크 안에서 종합적으로 제어하는 **최상위 시뮬레이션 허브**다.

---

## 1) 구조 개요 (System Overview)

**상위 통합 계층:**

- 입력: 2.1~2.8 각 시스템의 상태 데이터(경제, 정치, 치안, 확장, 명령, 기업 통제 등)
    
- 처리: 종합 계산(지표 산출, 상호 가중, 시간 경과 업데이트)
    
- 출력: 은하 상태(GlobalState), 긴장도(GTI), 명분지수(Legitimacy), 붕괴지수(Entropy), 이벤트 큐 갱신
    

**목적 요약:**

1. 분산된 시뮬레이션을 시간 단위(Tick)로 동기화.
    
2. 주요 지표(경제·정치·치안·명성)를 가중 평균하여 “은하 단계”를 결정.
    
3. 글로벌 이벤트(2.1.4)와 엔딩 루트(5.1) 트리거를 관리.
    

---

## 2) 주요 변수 정의 (Core Variables)

|변수명|설명|범위/단위|연동 시스템|
|---|---|---|---|
|GTI (Galactic Tension Index)|은하 긴장도|0.0~1.0|2.4 정치·조약, 2.1.4 이벤트|
|GSI (Galactic Stability Index)|은하 안정도|0.0~1.0|2.1.2 지역 효과, 2.1.3 경제 루프|
|GRI (Global Reputation Index)|명성/신뢰도|0.0~1.0|2.5 기업·PMC 통제|
|GEI (Galactic Economic Index)|은하 경제지표|0.0~1.0|2.1.3 경제 루프|
|GPI (Galactic Political Index)|정치적 균형|0.0~1.0|2.4 정치 시스템|
|Entropy|붕괴지수|0.0~1.0|2.1.4 이벤트, 5.1 엔딩|
|Legitimacy|명분지수|0.0~1.0|2.4 조약/전쟁 명분|
|Epoch|은하 단계|0~4|내부 전이(평화→긴장→전쟁→붕괴→재편)|

---

## 3) 계산 루프 (Simulation Tick)

**매 프레임(Tick) 연산 절차:**

```
1. 각 시스템 데이터 수집 (2.1~2.8)
2. 가중 통합 계산
   GTI = avg(Tension[nations]) + weight(EventIntensity)
   GEI = avg(EconomicOutput[planets]) × (1 - Entropy)
   GSI = avg(Security[regions]) × (1 - GTI)
   GPI = 1 - |PowerBalance - 0.5|
3. 파생 지표 갱신
   Entropy = clamp(Entropy + (GTI - GSI)*0.02, 0, 1)
   Legitimacy = clamp(Legitimacy + (GPI - 0.5)*0.03, 0, 1)
4. 은하 단계 전환
   if Entropy < 0.25 → Peace
   elif GTI < 0.4 → Tension
   elif GTI ≥ 0.4 and Entropy < 0.6 → War
   elif Entropy ≥ 0.6 → Collapse
   elif Entropy < 0.3 and Legitimacy > 0.7 → Reformation
5. 결과 반영
   → 2.1.4 이벤트 큐 업데이트, 2.4 외교 상태 조정, 5.1 엔딩 분기 플래그 설정
```

---

## 4) 데이터 인터페이스 (System I/O)

|입력 데이터|출처|설명|
|---|---|---|
|경제출력 (EconomicOutput)|2.1.3|행성별 생산·소비·가격 피드백|
|정치긴장 (PoliticalTension)|2.4|국가간 관계, 제재, 전쟁상태|
|치안상태 (SecurityLevel)|2.1.2|행성별 안정도 평균|
|기업통제 (CorporateControl)|2.5|계약/지분/명령 복종도|
|이벤트강도 (EventIntensity)|2.1.4|글로벌 이벤트 활성도 합산|
|전장결과 (CombatOutcomes)|2.7|승패 누적, 손실비율|

|출력 데이터|수신 시스템|설명|
|---|---|---|
|GlobalState|모든 시스템|은하 전체 상태 단계|
|Entropy/GSI/GTI 등|2.1.4, 5.1|이벤트 및 엔딩 판단 기준|
|PhaseTriggers|2.4, 2.5|외교/기업 정책 스위칭 조건|

---

## 5) 이벤트 트리거 (Global Event Triggers)

|조건|결과|
|---|---|
|GTI ≥ 0.5 3턴 지속|은하전(Universal War) 발발(2.1.4 호출)|
|Entropy ≥ 0.7|글로벌 붕괴 시나리오(5.1 The Anarchy of Stars) 진입|
|Legitimacy ≥ 0.8 & Entropy ≤ 0.3|재편 루트(5.1 Balance Restoration) 활성|
|GEI ≤ 0.3|경제위기 이벤트(2.1.4) 자동 등록|
|GSI ≤ 0.4|치안붕괴 시리즈(2.1.4) 발동|

---

## 6) 상태 머신 (Global State Machine)

|상태|전이조건|효과|
|---|---|---|
|**Peace**|초기값 / Entropy<0.25|거래량↑, 이벤트빈도↓|
|**Tension**|GTI>0.3 / GPI<0.6|정치/경제 변수 민감도 +20%|
|**War**|GTI≥0.4 / Entropy<0.6|군수 생산효율↑, 치안↓|
|**Collapse**|Entropy≥0.6|무역 중단, 반란 증가, 이벤트 폭주|
|**Reformation**|Legitimacy>0.7 & Entropy<0.3|평화 복귀 + 재편 이벤트 발동|

---

## 7) 데이터 모델 (ScriptableObject 설계)

**SimulationMetaManager.cs (예시)**

```
public class SimulationMetaManager : ScriptableObject {
    public float GTI, GSI, GEI, GPI, Entropy, Legitimacy;
    public int Epoch; // 0~4
    public List<GlobalEvent> eventQueue;
    public void Tick(float deltaTime) { /* 계산 루프 */ }
}
```

**GlobalEvent 구조체:** 이벤트 ID, 타입, 강도, 잔여턴, 출처, 영향계수.

---

## 8) 시각화(UI/UX 훅)

- **은하 상태보드:** GTI/GSI/Entropy/Legitimacy 게이지, 상태 단계 색상 전환.
    
- **이벤트 타임라인:** 발동·해결 이벤트를 시간축에 시각화.
    
- **은하 지도(2.1.5 연동):** 색상 오버레이로 Epoch 단계 표현 (파랑=평화 → 적=붕괴).
    
- **분석 탭:** 각 시스템별 기여도 그래프 (예: GTI 기여율: 정치 40%, 경제 30%, 치안 20%, 전장 10%).
    

---

## 9) 테스트 플로우 (QA)

- **S1:** 모든 국가 우호 / 무역확대 → GTI 0.2 유지 → Peace 지속.
    
- **S2:** 2국 이상 전쟁 / 치안저하 → GTI 0.6↑ → War 전이 확인.
    
- **S3:** 경제 붕괴 / 이벤트 폭주 → Entropy 0.7↑ → Collapse 단계 진입.
    
- **S4:** 전쟁 후 외교복원 / 기업개입 → Legitimacy 0.8↑, Entropy 0.3↓ → Reformation 복귀.
    

---

## 10) 버전

- v1.0 (2025-10-24, Asia/Seoul): 시스템 구조, 지표 계산, 이벤트 트리거, 상태 머신, 데이터 모델, UI 설계, QA 시나리오 포함.